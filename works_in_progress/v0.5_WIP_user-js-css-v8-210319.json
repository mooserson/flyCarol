{"libs":[{"name":"jQuery 3","src":"@extension@jquery.min.js"}],"settings":{"badgeCounter":false,"editorConfig":{"enableBasicAutocompletion":false,"enableLiveAutocompletion":true,"enableSnippets":true,"fontSize":15,"highlightActiveLine":false,"keyboardHandler":false,"showPrintMargin":false,"tabSize":4,"theme":"ace/theme/tomorrow","useSoftTabs":false,"useWorker":true,"wrap":true},"supportBtn":false,"themesFolder":["chrome","clouds","dawn","dracula","dreamweaver","eclipse","github","monokai","solarized_dark","solarized_light","textmate","tomorrow","tomorrow_night","twilight"],"version":8},"sites":[{"compiledCss":"[title=\"Warm Line Call Report\"] {background-color: rgba(0, 204, 153, 0.32)!important;}","css":"[title ='Warm Line Call Report'] {\n\tbackground-color: #00cc9952;\n}","id":"https://na0.icarol.com/secure/reports/SelectReportVersion.aspx","js":"$(\"[title ='Warm Line Call Report']\")[0].click()","libs":[],"name":"Auto-Select Report Type: Warm Line","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":".flyCarolButton:active {color: blue!important; box-shadow: rgb(153, 153, 153) 1px 1px 2px!important;}.flyCarolButton {position: fixed!important; width: 60px!important; height: 60px!important; left: 875px!important; font-size: 5.5em!important; background-color: rgba(0, 204, 153, 0.32)!important; border-radius: 50px!important; text-align: center!important; box-shadow: rgb(153, 153, 153) 2px 2px 3px!important;}#reverseOrderButton {top: 110px!important; padding-top: 4px!important;}#newPost {padding-top: 6px!important; top: 185px!important; font-size: 5em!important;}html {scroll-behavior: smooth!important;}","css":".flyCarolButton:active {\n\tcolor: blue;\n\tbox-shadow: 1px 1px 2px #999;\n}\n\n.flyCarolButton {\n\tposition:fixed;\n\twidth:60px;\n\theight:60px;\n\tleft: 875px;\n\tfont-size: 5.5em;\n\tbackground-color:#00cc9952;\n\tcolor:#00000;\n\tborder-radius:50px;\n\ttext-align:center;\n\tbox-shadow: 2px 2px 3px #999;\n}\n\n#reverseOrderButton{\n\ttop:110px;\n\tpadding-top: 4px;\n}\n\n#newPost {\n\ttop:170px;\n\tpadding-top: 6px;\n\ttop: 185px;\n\tfont-size: 5em;\n}\n\nhtml {\n  scroll-behavior: smooth;\n}","id":"https://na0.icarol.com/secure/forum*","js":"// fontawesome for icons\n$('head').append($(\"<script src='https://kit.fontawesome.com/29c8b6a8a8.js' crossorigin='anonymous'></script>\"))\n\n// grab table containing posts\nvar tbody = $('#cphBody_tblThread tbody');\n\n// groups <tr>s from chatboard correctly considering they are usually 3 but sometimes have attachments. (gotta be a better way)\nvar buildPostsArray = function(tdArray) {\n\tvar result = [[]]\n\tfor (var i = 0; i< tdArray.length; i ++) {\n\t\t// last sub array in result\n\t\tvar currentArray = result[result.length - 1]\n\t\t// add tr to currentArray\n\t\tcurrentArray.push(tdArray[i])\n\t\tif (currentArray.length === 3){\n\t\t\tvar currentTr = currentArray[2]\n\t\t\t// check if the 3rd element in the group is an attachment row, if so we add the next row and start a new group\n\t\t\tif (currentTr.innerHTML.includes('<span style=\"color:Red;\">')) {\n\t\t\t\tcurrentArray.push(tdArray[i+1])\n\t\t\t\tresult.push([])\n\t\t\t\ti ++\n\t\t\t// if not just start a new group\n\t\t\t} else {\n\t\t\t\tresult.push([])\n\t\t\t}\n\t\t}\n\t}\n\treturn result\n}\n\n// put elements into subarrays of specific length\nfunction chunkArray(array, size) {\n    let result = []\n    for (let i = 0; i < array.length; i += size) {\n        let chunk = array.slice(i, i + size)\n        result.push(chunk)\n    }\n    return result\n}\n\nfunction flipTable(tbody) {\n\tvar posts = $('tr', tbody).get();\n\t\n\t// var reverse_posts = chunkArray(posts, 3).reverse().flat();\n\tvar reverse_posts = buildPostsArray(posts).reverse().flat();\n\ttbody.append(reverse_posts);\n}\n\n// normally 3 elements (<tr>) per message, 4 with attachmenst so we only add the sort button for >3\nif (tbody.children().get().length > 3) {\n\t\n\t// add button\n\ttbody.append($(\"<i id='reverseOrderButton' class='fas fa-sort flyCarolButton'/></i>\"));\n\t\n\t$(\"#reverseOrderButton\").click(function() {\n\t\tflipTable(tbody);\n\t});\n}\n\ntbody.append($(\"<i id='newPost' class='fas fa-plus flyCarolButton'/></i>\"));\n\n$(\"#newPost\").click(function() {\n\t$(window).scrollTop($('#cphBody_txtMessageBody').position().top);\n\t$('#cphBody_txtMessageBody').focus()\n})\n","libs":[],"name":"Chatboard Reverse Posts + New Post Buttons","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":"fixes transparent-until-mouseover rows on past contacts page #cphBody_tblReportsList tr {background-color: rgb(255, 255, 255)!important;}.MainText {background-color: rgba(255, 230, 140, 0.8)!important;}","css":"/**/in case background image / JS fails\n\nform{\n\tbackground: linear-gradient(to right, transparent, mistyrose)\n}\n\n/**/ fixes transparent-until-mouseover rows on past contacts page\n#cphBody_tblReportsList tr{\n\tbackground-color: rgb(255, 255, 255);\n}\n\n.MainText {\n\tbackground-color: rgba(280, 230, 140, .8);   \n}","id":"https://na0.icarol.com/*","js":"var splashUrl\n\n// different background by day\nswitch((new Date).getDay()) {\n\tcase 0:\n\t\t// birds on a wire\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1519746889240-5cfec298abd5?ixlib=rb-1.2.1&auto=format&fit=crop&w=1615&q=80'\n\t\tbreak;\n\tcase 1:\n\t\t// sunset silhoutte houses\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1582296767780-75674eee90bc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2159&q=80'\n\t\tbreak;\n\tcase 2:\t\n\t\t// Carmine bee eaters\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1600586818872-ccf4923729e4?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2089&q=80'\n\t\tbreak;\n\tcase 3:\n\t\t// flamingo in water\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1559617350-6eee0f8b702a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80'\n\t\tbreak;\n\tcase 4:\n\t\t// Eclectus parrot is a parrot native to the Solomon Islands\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1588400743909-3eeebe292654?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80'\n\t\tbreak;\n\tcase 5:\t\n\t\t// Canada Geese at Night\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1565935860334-ef922a1b5243?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80'\n\t\tbreak;\n\tcase 6:\n\t\t// kingfisher\n\t\tsplashUrl = 'https://images.unsplash.com/photo-1525353559516-2c665f02d90c?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1651&q=80'\n}\n\n$(\"form\").css({background: `linear-gradient(to right, transparent, mistyrose), url(\"${splashUrl}\")`, backgroundRepeat: \"no-repeat\", backgroundAttachment: \"fixed\", backgroundPosition: \"center\",  backgroundSize: \"cover\"})\n\n// no-repeat center center fixed\n\n","libs":[],"name":"Global Background Styling","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":"input[name=\"ctl00$cphBody$btnSearch\"] {width: 82px !important;}","css":"input[name=\"ctl00$cphBody$btnSearch\"]{\n\twidth: 82px!important;\n}","id":"https://na0.icarol.com/secure/reports/ReportMain.aspx","js":"var search_field = $(\"[name='ctl00$cphBody$txtSearch'\")\nvar search_button = $(\"[name='ctl00$cphBody$btnSearch']\")\nfunction search_text () {\n\treturn search_field.val()\n}\n\t\nsearch_button.click(function (e) {\n\tif (search_text().length === 7 && search_text().match(/\\d{7}/g)) {\n\t\te.preventDefault()\n\t\tconsole.log(search_text())\n\t\twindow.location.assign('https://na0.icarol.com/secure/profiles/ProfileView2.aspx?CallerNum=' + search_text())\n\t\tconsole.log(e)\n\t};\n})\n\nsearch_field.on(\"keyup change paste\", function () {\n\tif (search_text().length === 7 && !isNaN(search_text()) ) {\n\t\tsearch_button.prop(\"value\", \"Profile Lookup\");\n\t\tconsole.log(\"hit\")\n\t} else {\n\t\tsearch_button.prop(\"value\", \"Search\");\n\t\tconsole.log(\"miss\")\n\t}\n\tconsole.log(search_text)\n});","libs":[],"name":"Contacts Profile Search","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":"html {scroll-behavior: smooth!important;}#scrollToTop {padding: 0.2em!important; position: fixed!important; right: 10%!important; bottom: 10%!important; font-size: 6.5em!important; background-color: rgba(0, 204, 153, 0.32)!important; border-radius: 50px!important; text-align: center!important; box-shadow: rgb(153, 153, 153) 2px 2px 3px!important; height: auto!important; transition: opacity 0.3s ease-out 0s!important; user-select: none!important;}#scrollToTop.hidden {transition: opacity 0.3s ease-out 0s!important; opacity: 0!important;}#scrollToTop:active {box-shadow: rgb(153, 153, 153) 1px 1px 1px!important;}#topText {font-size: 0.5em!important; font-family: sans-serif!important;}","css":"html {\n  scroll-behavior: smooth;\n}\n\n#scrollToTop{\n\tpadding: .2em;\n\tposition: fixed;\n\tright: 10%;\n\tbottom: 10%;\n\tfont-size: 6.5em;\n\tbackground-color:#00cc9952;\n\tborder-radius:50px;\n\ttext-align:center;\n\tbox-shadow: 2px 2px 3px #999;\n\ttransition: 0.3s;\n\theight: auto;\n\ttransition: opacity .3s ease-out;\n\t\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\n#scrollToTop.hidden {\n\ttransition: opacity .3s ease-out;\n\topacity: 0;\n}\n\n#scrollToTop:active {\n\tbox-shadow: 1px 1px 1px #999;\n}\n\n#topText {\n\tfont-size: .5em;\n\tfont-family: Sans-Serif;\n}","id":"https://na0.icarol*","js":"// fontawesome for icons\n$('head').append($(\"<script src='https://kit.fontawesome.com/29c8b6a8a8.js' crossorigin='anonymous'></script>\"))\n\n// create button\n$( 'body' ).append($(\"<i id='scrollToTop' class='fas fa-arrow-up hidden'><div id='topText'>Top</div></i>\"))\n\n// jump to top click listener\n$(\"#scrollToTop\").click( function () {\n\tdocument.documentElement.scrollTop = 0\n\t// document.body.scrollTop = 0; // For Safari\n})\n\n// show button on scroll\n$( window ).scroll(function() {\n  if ($( window ).scrollTop() > 500) {\n  \t$(\"#scrollToTop\").removeClass(\"hidden\")\n  } else {\n  \t$(\"#scrollToTop\").addClass(\"hidden\")\n  }\n});\n","libs":[],"name":"Scroll To Top Button","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":".warningMessage {background-color: rgba(255, 198, 152, 0.55)!important; font-size: 9pt!important; color: red !important;}","css":".warningMessage {\n\tcolor: red !important;\n\tbackground-color: #ffc6988c;\n\tfont-size: 9pt;\n}","id":"https://na0.icarol.com/*&Action=New*, &Draft=True","js":"// Checks 'Peer Services' for Mental Health\n// Encourages the single-page view\n\nvar peerCheckbox = $(\"[fieldname='Peer Services'] >\");\n\n// not needed?\nfunction sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\n// check peer services\nfunction peerServicesEnforcer() {\n\tif(!peerCheckbox.prop('checked')){\n\t\t$(\"[fieldname='Peer Services'] > \")[0].click();\n\t}\n}\npeerServicesEnforcer()\n\n\n\n// encourage single-page view ------------------------------------------\nfunction showTabViewWarning() {\n\t$(\"a#hlSinglePage\").addClass(\"warningMessage\").html('Show as Single Page --> Recomended for flyCarol! \\n')\n}\n\nfunction hideTabViewWarning() {\n\t$(\"a#hlSinglePage\").removeClass(\"warningMessage\")\n}\n\n$(document).change(function () {\n\ttabViewWarningCheck()\n})\n\nfunction tabViewWarningCheck () {\n\tif ( $('ul#ulTabs').is(\":visible\") ) {\n\t\tshowTabViewWarning()\n\t\t// console.log(\"show warning\");\n\t} else {\n\t\thideTabViewWarning()\n\t\t// console.log(\"hide warning\");\n\t}\n\n\t// using timeout since checking for ulTabs:visible was happening too fast and then not triggering the warning. $(document).change was also not working for the same reason it appeared\n\tsetTimeout(function() {\n    \t// console.log(\"waitForIframeEl setting timeout\")\n      tabViewWarningCheck();\n      //console.log(\"checked\")\n    }, 1000)\n}\n\ntabViewWarningCheck()\n\n// todo: hide survey field for CalHope\n// if ($(\"head title:contains(New View a CalHOPE Call Report)\").length) {\n// };","libs":[],"name":"New Call Report Helper","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":"[title=\"CalHOPE Call Report\"] {background-color: rgba(0, 204, 153, 0.32)!important;}","css":"[title ='CalHOPE Call Report'] {\n\tbackground-color: #00cc9952;\n}","id":"https://na0.icarol.com/secure/reports/SelectReportVersion.*","js":"$(\"[title ='CalHOPE Call Report']\")[0].click()\n\n","libs":[],"name":"Auto-Select Report Type: CalHope","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":false}},{"compiledCss":"#cphBody_chkNoFeedback ~ label {background-color: rgba(0, 204, 153, 0.32)!important; font-weight: bold!important;}","css":"#cphBody_chkNoFeedback ~ label {\n\tbackground-color: #00cc9952;\n\tfont-weight: bold;\n}","id":"https://na0.icarol.com/secure/reports/ReportV*, !&Action=New*, !*&Draft=True","js":"$(\"#cphBody_chkNoFeedback ~ label\").html(\"No feedback to give on this contact record. ⏭️ Shortcut: press 'n'\")\n\n$(document).keydown( function(e) {\n\tif (e.target.tagName.toLowerCase() !== 'input' &&\n        e.target.tagName.toLowerCase() !== 'textarea' && e.keyCode==78) {\n    \t$(\"#cphBody_chkNoFeedback\").click();\n\t\tconsole.log(\"Next triggered outside text\")\n\t}\n});","libs":[],"name":"[Coordinators] Call Review Helpers","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}},{"compiledCss":".flyCarolButton {position: fixed!important; width: 100px!important; height: 60px!important; font-size: 16px!important; font-weight: bold!important; border-radius: 50px!important; text-align: center!important; box-shadow: rgb(153, 153, 153) 2px 2px 3px!important; font-family: sans-serif!important; left: 950px!important; outline: none!important;}.flyCarolButton:active {box-shadow: rgb(153, 153, 153) 1px 1px 1px!important;}.flyCarolButton.disabled {background-color: rgba(133, 146, 143, 0.32)!important; color: rgba(28, 31, 30, 0.32)!important;}.wlButton {background-color: rgba(28, 63, 149, 0.38)!important; color: rgb(255, 198, 152)!important;}.wlButton:active {color: blue!important;}#addWlReferralButton {top: 155px!important; padding-top: 5px!important;}#setWlTriageButton {top: 220px!important;}.chButton {background-color: rgba(255, 198, 152, 0.55)!important; color: rgb(28, 63, 149)!important;}.chButton:active {color: rgb(255, 152, 0)!important;}#addChReferralButton {top: 285px!important; padding-top: 5px!important;}#setChTriageButton {top: 350px!important;}.pcButton {background-color: rgba(0, 204, 153, 0.32)!important;}.pcButton:active {color: rgba(0, 204, 153, 0.32)!important;}#addPcReferralButton {top: 415px!important; font-size: 14px!important;}.headless {display: none !important;}.alertEmptyField {background-color: red!important;}.messageOverlay {user-select: none!important; position: fixed!important; top: 80%!important; height: 6.5vw!important; width: 50vw!important; border-radius: 50px!important; text-align: center!important; font-family: sans-serif!important; font-size: 2.6vw!important; outline: none!important; transition: opacity 0.5s ease 0s!important; background-color: rgb(132, 199, 183)!important;}.messageOverlay:hover {opacity: 0!important; z-index: 0!important;}.hidden {opacity: 0!important; z-index: -1!important;}","css":".flyCarolButton{\n\tposition:fixed;\n\twidth:100px;\n\theight:60px;\n\tfont-size: 16px;\n\tfont-weight: bold;\n\tcolor:#00000;\n\tborder-radius:50px;\n\ttext-align:center;\n\tbox-shadow: 2px 2px 3px #999;\n\tfont-family: Sans-Serif;\n\tleft: 950px;\n\toutline: none;\n}\n\n.flyCarolButton:active {\n\tbox-shadow: 1px 1px 1px #999;\n}\n\n.flyCarolButton.disabled {\n\tbackground-color:#85928f52;\n\tcolor: #1c1f1e52;\n}\n\n.wlButton {\n\tbackground-color:#1c3f9561;\n\tcolor: #ffc698;\n}\n\n.wlButton:active {\n\tcolor: blue;\n}\n\n#addWlReferralButton{\n\ttop:155px;\n\tpadding-top: 5px;\n}\n\n#setWlTriageButton{\n\ttop:220px;\n}\n\n\n.chButton {\n\tbackground-color: #ffc6988c;\n\tcolor: #1c3f95;\n}\n\n.chButton:active {\n\tcolor: #ff9800;\n}\n\n#addChReferralButton{\n\ttop:285px;\n\tpadding-top: 5px;\n}\n\n#setChTriageButton{\n\ttop:350px;\n}\n\n.pcButton{\n\tbackground-color: #00cc9952;\n}\n\n.pcButton:active {\n\tcolor: #00cc9952;\n}\n\n#addPcReferralButton{\n\ttop: 415px;\n\tfont-size: 14px;\n}\n\n.headless {\n\tdisplay: none !important;\n}\n\n.alertEmptyField {\n\tbackground-color: red;\n}\n\n.messageOverlay {\n\tuser-select: none;\n\tposition: fixed;\n\ttop: 80%;\n\theight: 6.5vw;\n\twidth: 50vw;\n\tborder-radius:50px;\n\ttext-align:center;\n\tfont-family: Sans-Serif;\n\tfont-size: 2.6vw;\n\toutline: none;\n\ttransition: opacity .5s;\n\tbackground-color: #84c7b7;\n}\n\n.messageOverlay:hover {\n\topacity: 0;\n\tz-index: 0;\n}\n\n.hidden {\n\topacity: 0;\n\tz-index: -1;\n}","id":"!ForumID, &Action=New*, *&Draft=True, &Action=Edit","js":"// File Outline (currently hard to split up into separate files due to url-matching dependency)\n// :8 - :55 Add buttons and button listeners\n// :55 - :131 Helper Functions and Listeners (iFrame)\n// :131 - :203 WL functions :203 -> 273 CH functions\n// :313 ->.. PC functions\nvar iframe = $(\"iframe#frResources\")\nvar iframeContainer = iframe.parent().parent()\n\n// -------------------------------------Buttons and Listeners------------------------------------\n\n// add Resource Iframe opacity reset on-click to deal with referWarmline() failing to remove .headless\n$(\"#hlSearchResources\").click(function () {\n\tiframeContainer.removeClass(\"headless\")\n})\n\n// build CH Triage button\n$(\"#MainContent\").append($(\"<button id='setChTriageButton' class='flyCarolButton chButton'>Insta-CH-Triage</button>\"))\n\n// add CH Triage button click listener\n$(\"#setChTriageButton\").click(function (e) {\n\te.preventDefault()\n\tsetChTriage()\n})\n\n// build CH Referral button\n$(\"#MainContent\").append($(\"<button id='addChReferralButton' class='flyCarolButton chButton'>CalHope Referral</button>\"))\n\n// add CH Ref button click listener\n$(\"#addChReferralButton\").click(function (e) {\n\te.preventDefault()\n\tif (canReferCalhope()) {\n\t\treferCalhope()\n\t}\n})\n\n// build WL Triage button\n$(\"#MainContent\").append($(\"<button id='setWlTriageButton' class='flyCarolButton wlButton'>Insta-WL-Triage</button>\"))\n\n// add WL Triage button click listener\n$(\"#setWlTriageButton\").click(function (e) {\n\te.preventDefault()\n\tsetWlTriage()\n})\n\n// build WL Referral button\n$(\"#MainContent\").append($(\"<button id='addWlReferralButton' class='flyCarolButton wlButton'>Warmline Referral</button>\"))\n\n// add WL Ref button click listener\n$(\"#addWlReferralButton\").click(function (e) {\n\te.preventDefault()\n\tif (canReferWarmline()) {\n\t\treferWarmline()\n\t}\n})\n\n// check if WL referred and disable or enable button\n$(document).on('DOMNodeInserted DOMNodeRemoved', function () {\n\tif (canReferWarmline()) {\n\t\t$(\"#addWlReferralButton\").removeClass(\"disabled\")\n\t} else {\n\t\t$(\"#addWlReferralButton\").addClass(\"disabled\")\n\t}\n})\n\n// add PC referral button \n$(\"#MainContent\").append($(\"<button id='addPcReferralButton' class='flyCarolButton pcButton'>Peer Connections SF Only</button>\"))\n\n// add PC Ref button click listener\n$(\"#addPcReferralButton\").click(function (e) {\n\te.preventDefault()\n\tif (canReferPeerconn()) {\n\t\treferPeerconn()\n\t}\n})\n\n// check if PC referred and disable or enable button and overlay\n$(document).on('DOMNodeInserted DOMNodeRemoved', function () {\n\tif (canReferPeerconn()) {\n\t\t$('#addPcReferralButton').removeClass('disabled')\n\t\thideMessageOverlay()\n\t} else {\n\t\t$('#addPcReferralButton').addClass('disabled')\n\t\tshowMessageOverlay(\"Please confirm caller is in SF, and not a current/past PC participant before referral\")\n\t}\n})\n\n// Remove alertEmptyField class when Name is entered\n$(\"#cphBody_txtCaller\").on(\"change\", function () {\n\tif (isNameSet()) {\n\t\t$(\"#cphBody_txtCaller\").removeClass(\"alertEmptyField\")\n\t}\n})\n\n// build message overlay button\n$('#MainContent').append($(\"<div class='messageOverlay hidden'></div>\"))\n\n// Remove alertEmptyField class when VM status selected, [not in use, see setPeerconnFollowup() comment]\n// $(\"#cphBody_ddActivityOKToLeaveMessage\").on(\"change\", function () {\n// \tif (isLeaveMessageFuSet()) {\n// \t\t$(\"#cphBody_ddActivityOKToLeaveMessage\").removeClass(\"alertEmptyField\")\n// \t}\n// })\n\n// ------------------------------------Helper Functions and listeners---------------\n\n// wait for load in iframe\nfunction waitForIframeEl (selector, callback) {\n\t// console.log(window.frames[0])\n  try {\n  \twindow.frames[0].$(selector).length\n  \t// console.log(\"firing callback\")\n    callback();\n  } catch(err) {\n  \t// console.log(\"Error in waitForIframeEl: \" + err)\n    setTimeout(function() {\n    \t// console.log(\"waitForIframeEl setting timeout\")\n      waitForIframeEl(selector, callback);\n    }, 100);\n  }\n};\n\n// wait for load in doc\nfunction waitForEl (selector, callback) {\n  if ($(selector).length) {\n  \t// console.log(\"firing callback\")\n    callback();\n  } else {\n    setTimeout(function() {\n    \t// console.log(\"setting timeout\")\n      waitForEl(selector, callback);\n    }, 100);\n  }\n}\n\n// ensures styling on iframe is reset if auto refer errors out\nfunction resetIframe () {\n\tsetTimeout(function(){\n\t\ttry {\n\t\t\twindow.frames[0].CloseWindow()\n\t\t} catch(err) {\n\t\t}\n\t\tiframeContainer.removeClass(\"headless\")\n\t\t$(\"#addWlReferralButton\").html(\"Warm Line Referral\")\n\t}, 5000);\n}\n\n// check for name in place\nfunction isNameSet () {\n\treturn !!$(\"#cphBody_txtCaller\")[0].value\n}\n\n// scroll to name field and highlight\nfunction alertNameMissing () {\n\tvar el = $(\"#cphBody_txtCaller\")\n\t$(\"#cphBody_txtCaller\").addClass(\"alertEmptyField\")\n\tscrollToElement(el)\n\t$('#cphBody_txtMessageBody').focus()\n}\n\nfunction getNextWorkDay(date) {\n\tvar nextWorkDay = new Date;\n\tvar dayOfWeek = date.getDay(),add = 1;\n\tif (dayOfWeek===5) add=3;\n\telse if (dayOfWeek===6) add=2;\n\t// Date.setDate() accounts for going into the next month \n\tnextWorkDay.setDate(date.getDate()+add);  \n\treturn nextWorkDay;\n}\n\nfunction scrollToElement(el) {\n\tel = $(el)\n\tvar elOffset = el.offset().top;\n\tvar elHeight = el.height();\n\tvar windowHeight = $(window).height();\n\tvar offset;\n\t\n\tif (elHeight < windowHeight) {\n\t\toffset = elOffset - ((windowHeight / 2) - (elHeight / 2));\n\t}\n\telse {\n\t\toffset = elOffset;\n\t}\n\tdocument.documentElement.scrollTo(null, offset)\n}\n\nfunction showMessageOverlay(message) {\n\tvar el = document.getElementsByClassName('messageOverlay')[0]\n\tel.textContent = message\n\tel.setAttribute('role', 'alert')\n\tel.classList.remove('hidden')\n}\n\nfunction hideMessageOverlay() {\n\tvar el = document.getElementsByClassName('messageOverlay')[0]\n  el.classList.add(\"hidden\")\n}\n\n// ------------------------WL Functions------------------------- todo: refactor into line-agnostic (CH/WL)\n\n// just ensures that WL is referred before firing\nfunction waitForWarmlineReferral (callback) {\n\twaitForEl(\"a#cphBody_ShowResource30650266\", callback);\n}\n\n// check if WL already referred\nfunction canReferWarmline () {\n\treturn !$(\"a#cphBody_ShowResource30650266\").length\n}\n\n// navigate the resource modal and refer WL\nfunction referWarmline () {\n\t// check Peer Service Referral \n\tif($(\"[fieldname='Peer service referral '] > \").prop(\"checked\") === false){\n        $(\"[fieldname='Peer service referral '] > \")[0].click();\n    }\n\t\n\t// open Resource modal\n\t$(\"#hlSearchResources\")[0].click()\n\t\n\t// display iframe empty and button with elipses\n\tiframeContainer.addClass(\"headless\")\n\t$(\"#addWlReferralButton\").html(\"...\")\n\t\n\t// start timer to fix bugging iframe\n\tresetIframe()\n\t\n\t// navigate resources and refer WL\n\tiframe.on(\"load\", function () {\n\t\tiframe.off(\"load\")\n\t\twindow.frames[0].$(\"a:contains(California Warmlines)\")[0].click()\n\t\t// console.log(\"debug: auto-clicked California Warmlines\")\n\t\twaitForIframeEl(\"input#MakeReferral30650266\", function() {\n\t\t\twindow.frames[0].$(\"input#MakeReferral30650266\")[0].click()\n\t\t\t// console.log(\"debug: auto-clicked make referrals\")\n\t\t\twaitForIframeEl(\"#MakeReferral30650266[value='Referral made']\", function() {\n\t\t\t\tiframeContainer.removeClass(\"headless\")\n\t\t\t\t$(\"#addWlReferralButton\").html(\"Warm Line Referral\")\n\t\t\t\twindow.frames[0].CloseWindow()\n\t\t\t\t// console.log(\"debug: auto-clicked close iframe\")\n\t\t\t})\n\t\t});\n\t})\n}\n\n// refer WL, set call type and submit CR\nfunction setWlTriage () {\n\tif (isNameSet()) {\n\t\t$(\"option:contains('Asked to Call Back')\").prop(\"selected\", \"selected\");\n\t\tif (canReferWarmline()) {\n\t\t\treferWarmline()\n\t\t}\n\t\twaitForWarmlineReferral(function () {\n\t\t\t$(\"#cphBody_btnReportSubmit\").click()\n\t\t})\n\t} else {\n\t\talertNameMissing()\n\t}\n};\n\n// ------------------------------------------CH Functions-------------------------\n// just ensures that CH is referred before firing\nfunction waitForCalhopeReferral (callback) {\n\twaitForEl(\"a#cphBody_ShowResource68541424\", callback);\n}\n\n// check if CH already referred\nfunction canReferCalhope () {\n\treturn !$(\"a#cphBody_ShowResource68541424\").length\n}\n\n// navigate the resource modal and refer CH\nfunction referCalhope () {\n\t// check Peer Service Referral \n\tif($(\"[fieldname='Peer service referral '] > \").prop(\"checked\") === false){\n        $(\"[fieldname='Peer service referral '] > \")[0].click();\n    }\n\t\n\t// open Resource modal\n\t$(\"#hlSearchResources\")[0].click()\n\t\n\t// display iframe empty and button with elipses\n\tiframeContainer.addClass(\"headless\")\n\t$(\"#addChReferralButton\").html(\"...\")\n\t\n\t// start timer to fix bugging iframe\n\tresetIframe()\n\t\n\t// navigate resources and refer CH\n\tiframe.on(\"load\", function () {\n\t\tiframe.off(\"load\")\n\t\twindow.frames[0].$(\"a:contains(California Warmlines)\")[0].click()\n\t\t// console.log(\"debug: auto-clicked California Warmlines\")\n\t\twaitForIframeEl(\"input#MakeReferral68541424\", function() {\n\t\t\twindow.frames[0].$(\"input#MakeReferral68541424\")[0].click()\n\t\t\t// console.log(\"debug: auto-clicked make referrals\")\n\t\t\twaitForIframeEl(\"#MakeReferral68541424[value='Referral made']\", function() {\n\t\t\t\tiframeContainer.removeClass(\"headless\")\n\t\t\t\t$(\"#addChReferralButton\").html(\"CalHope Referral\")\n\t\t\t\twindow.frames[0].CloseWindow()\n\t\t\t\t// console.log(\"debug: auto-clicked close iframe\")\n\t\t\t})\n\t\t});\n\t})\n}\n\n// refer CH, set call type and submit CR\nfunction setChTriage () {\n\tif (isNameSet()) {\n\t\t$(\"option:contains('Asked to Call Back')\").prop(\"selected\", \"selected\");\n\t\tif (canReferCalhope()) {\n\t\t\treferCalhope()\n\t\t}\n\t\twaitForCalhopeReferral(function () {\n\t\t\t$(\"#cphBody_btnReportSubmit\").click()\n\t\t})\n\t} else {\n\t\talertNameMissing()\n\t}\n};\n\n// check if CH referred and disable or enable button\n$(document).on('DOMNodeInserted DOMNodeRemoved', function () {\n\tif (canReferCalhope()) {\n\t\t$(\"#addChReferralButton\").removeClass(\"disabled\")\n\t} else {\n\t\t$(\"#addChReferralButton\").addClass(\"disabled\")\n\t}\n})\n\n// ------------------------------------------PC Functions-------------------------\n\n// just ensures that PC is referred before firing\nfunction waitForPeerconnReferral (callback) {\n\twaitForEl(\"a#cphBody_ShowResource68264874\", callback);\n}\n\n// check if PC already referred\nfunction canReferPeerconn () {\n\treturn !$(\"a#cphBody_ShowResource68264874\").length\n}\n\n// navigate the resource modal and refer PC\nfunction referPeerconn () {\n\t// check Peer Service Referral \n\tif($(\"[fieldname='Peer service referral '] > \").prop(\"checked\") === false){\n        $(\"[fieldname='Peer service referral '] > \")[0].click();\n    }\n\t\n\t// open Resource modal\n\t$(\"#hlSearchResources\")[0].click()\n\t\n\t// display iframe empty and button with elipses\n\tiframeContainer.addClass(\"headless\")\n\t$(\"#addPcReferralButton\").html(\"...\")\n\t\n\t// start timer to fix bugging iframe\n\tresetIframe()\n\t\n\t// navigate resources and refer CH\n\tiframe.on(\"load\", function () {\n\t\tiframe.off(\"load\")\n\t\twindow.frames[0].$(\"a:contains(Peer-Run Programs & Groups)\")[0].click()\n\t\t// console.log(\"debug: auto-clicked Peer-Run Programs & Groups\")\n\t\twaitForIframeEl(\"input#MakeReferral68264874\", function() {\n\t\t\twindow.frames[0].$(\"input#MakeReferral68264874\")[0].click()\n\t\t\t// console.log(\"debug: auto-clicked make referrals\")\n\t\t\twaitForIframeEl(\"#MakeReferral68264874[value='Referral made']\", function() {\n\t\t\t\tiframeContainer.removeClass(\"headless\")\n\t\t\t\t$(\"#addPcReferralButton\").html(\"Peer Connections SF ONLY\")\n\t\t\t\twindow.frames[0].CloseWindow()\n\t\t\t\t// console.log(\"debug: auto-clicked close iframe\")\n\t\t\t})\n\t\t});\n\t})\n\tsetPeerconnFollowup()\n}\n\n// set f/u for PC; naming convention: Fu == follow up\n function setPeerconnFollowup() {\n \tsetFuStatus('Open')\n \t\n \t// copies phone from Contact Information if present\n \tlet number = document.getElementById('cphBody_txtLookupPhone').value\n \t\n \tsetFuPhone(number)\n \t\n \tsetFuTriesCount('2 times')\n \t\n \t// Peer-connections user # 149328\n \tsetFuAssignedTo(149328)\n \t\n \t// set due date to tomorrow\n \tsetFuDueDate(getNextWorkDay(new Date))\n \t\n \t// set time to 4pm\n \tsetFuDueTime(16, 0)\n \t\n \tsetFuSubject('Peer Connections Referral')\n \t\n \t// scroll to the \"ok to leave message?\" if an option is not selected already\n \t// COMMENTING OUT for now, can come back and add all the checks for completion but the iCarol form does that upon save anyways. Just a nice-to-have\n \t// if (!isLeaveMessageFuSet()) {\n \t// \tfocusOnFuMessage()\n \t// }\n}\n\nfunction setFuStatus (val) {\n\ttry {\n\t\tdocument.getElementById('cphBody_ddActivityStatus').value = val\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\nfunction setFuPhone (val) {\n\ttry {\n\tdocument.getElementById('cphBody_txtActivityPhoneNumber').value = val\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\nfunction setFuTriesCount (val) {\n\ttry {\n\t\tdocument.getElementById('cphBody_ddActivityNumberOfContactAttemptsToMake').value = val\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\nfunction setFuAssignedTo(val) {\n\ttry {\n\t\tdocument.getElementById('cphBody_ddActivityAssignedTo').value = val\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\n// time-string format \"123pm\"\nfunction setFuDueDate(val) {\n\tlet day = val.getDate()\n\tlet month = val.getMonth() + 1\n\tlet year = val.getFullYear()\n\tlet dateString = `${month}/${day}/${year}`\n\ttry {\n\t\tdocument.getElementById('cphBody_cpActivityDueOn_textBox').value = dateString\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\n// \"hour\" \"minute\" in 24hr time\nfunction setFuDueTime (hour, minute){\n\tvar period\n\n\t// round to nearest 5\n\tminute = Math.round(minute/5) * 5\n\tif (hour >= 12) {\n\t\tperiod = \"PM\"\n\t} else {\n\t\tperiod = \"AM\"\n\t}\n\t\n\t// fit within 12hr clock\n\thour = hour % 12\n\t\n\ttry {\n\t\tdocument.getElementById('cphBody_ddActivityHour').value = hour\n\t\tdocument.getElementById('cphBody_ddActivityMinute').value = minute\n\t\tdocument.getElementById('cphBody_ddActivityAMPM').value = period\n\t} catch (err) {\n\t\tconsole.log(err)\n\t}\n}\n\nfunction setFuSubject(subject) {\n\tif (!document.getElementById('cphBody_txtActivityTitle').value) {\n\t\ttry {\n\t\t\tdocument.getElementById('cphBody_txtActivityTitle').value = subject\n\t\t} catch (err) {\n\t\t\tconsole.log(err)\n\t\t}\n\t}\n}\n\n// not in use, see comment in setPeerconnFollowup()\n// function isLeaveMessageFuSet() {\n// \treturn document.getElementById('cphBody_ddActivityOKToLeaveMessage').value != '(not specified)'\n// }\n\n// not in use, see comment in setPeerconnFollowup()\n// function focusOnFuMessage() {\n// \tvar el = document.getElementById('cphBody_ddActivityOKToLeaveMessage');\n// \tel.classList.add('alertEmptyField');\n// \tscrollToElement(el);\n// }\n","libs":["jQuery 3"],"name":"WL/CH/PC Referral + Triage Buttons","options":{"altCSS":false,"altJS":false,"autoImportant":false,"on":true}}]}